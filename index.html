<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Workflow Builder â€” AI Execution Planner</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Mono:ital,wght@0,300;0,400;1,300&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet"/>
<style>
/* â”€â”€ Reset & Variables â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg:        #08090a;
  --surface:   #0f1012;
  --surface2:  #15171a;
  --surface3:  #1c1f23;
  --border:    #252830;
  --border2:   #2e3138;
  --accent:    #c8f04a;
  --accent-dim:#8aaa2e;
  --accent-glow: rgba(200,240,74,0.12);
  --red:       #ff4d4d;
  --blue:      #4da6ff;
  --text:      #eef0f4;
  --text-2:    #8b909a;
  --text-3:    #4a4f5a;
  --font-head: 'Syne', sans-serif;
  --font-mono: 'DM Mono', monospace;
  --font-body: 'DM Sans', sans-serif;
  --radius:    12px;
  --transition: 0.18s cubic-bezier(.4,0,.2,1);
}

html { scroll-behavior: smooth; }

body {
  background: var(--bg);
  color: var(--text);
  font-family: var(--font-body);
  font-size: 15px;
  line-height: 1.6;
  min-height: 100vh;
  overflow-x: hidden;
}

/* â”€â”€ Noise texture overlay â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
body::before {
  content: '';
  position: fixed;
  inset: 0;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.035'/%3E%3C/svg%3E");
  pointer-events: none;
  z-index: 0;
  opacity: 0.6;
}

/* â”€â”€ Grid background â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
body::after {
  content: '';
  position: fixed;
  inset: 0;
  background-image:
    linear-gradient(var(--border) 1px, transparent 1px),
    linear-gradient(90deg, var(--border) 1px, transparent 1px);
  background-size: 48px 48px;
  opacity: 0.18;
  pointer-events: none;
  z-index: 0;
}

/* â”€â”€ Layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.wrapper {
  position: relative;
  z-index: 1;
  max-width: 780px;
  margin: 0 auto;
  padding: 60px 24px 100px;
}

/* â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
header {
  margin-bottom: 56px;
  animation: fadeUp 0.6s ease both;
}

.header-tag {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  background: var(--surface2);
  border: 1px solid var(--border2);
  border-radius: 100px;
  padding: 5px 14px 5px 10px;
  font-family: var(--font-mono);
  font-size: 11px;
  color: var(--accent);
  margin-bottom: 22px;
  letter-spacing: .04em;
}

.header-tag::before {
  content: '';
  width: 6px; height: 6px;
  background: var(--accent);
  border-radius: 50%;
  box-shadow: 0 0 8px var(--accent);
  animation: pulse 2s ease infinite;
}

h1 {
  font-family: var(--font-head);
  font-size: clamp(36px, 7vw, 58px);
  font-weight: 800;
  line-height: 1.05;
  letter-spacing: -0.03em;
  color: var(--text);
  margin-bottom: 14px;
}

h1 span {
  color: var(--accent);
  position: relative;
}

.subtitle {
  font-size: 16px;
  color: var(--text-2);
  font-weight: 300;
  max-width: 480px;
  line-height: 1.6;
}

/* â”€â”€ Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 28px;
  margin-bottom: 16px;
  animation: fadeUp 0.6s ease both;
  position: relative;
  overflow: hidden;
  transition: border-color var(--transition);
}

.card:hover { border-color: var(--border2); }

.card::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 1px;
  background: linear-gradient(90deg, transparent, var(--border2), transparent);
}

.card:nth-child(1) { animation-delay: 0.1s; }
.card:nth-child(2) { animation-delay: 0.2s; }

.label {
  font-family: var(--font-mono);
  font-size: 10px;
  font-weight: 400;
  letter-spacing: .12em;
  text-transform: uppercase;
  color: var(--text-3);
  margin-bottom: 10px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.label-num {
  background: var(--surface3);
  border: 1px solid var(--border2);
  border-radius: 4px;
  padding: 1px 6px;
  font-size: 9px;
  color: var(--text-2);
}

textarea, input[type="text"] {
  width: 100%;
  background: var(--surface2);
  border: 1px solid var(--border2);
  border-radius: var(--radius);
  color: var(--text);
  font-family: var(--font-body);
  font-size: 14.5px;
  font-weight: 300;
  line-height: 1.65;
  padding: 14px 16px;
  resize: vertical;
  transition: border-color var(--transition), box-shadow var(--transition);
  outline: none;
}

textarea:focus, input[type="text"]:focus {
  border-color: var(--accent-dim);
  box-shadow: 0 0 0 3px var(--accent-glow);
}

textarea::placeholder, input::placeholder {
  color: var(--text-3);
  font-weight: 300;
}

#instruction { min-height: 80px; resize: none; }
#document    { min-height: 180px; }

.char-count {
  text-align: right;
  font-family: var(--font-mono);
  font-size: 10px;
  color: var(--text-3);
  margin-top: 6px;
  transition: color var(--transition);
}

.char-count.warn { color: #f0a020; }
.char-count.over { color: var(--red); }

/* â”€â”€ Button â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.btn-row {
  margin-top: 8px;
  animation: fadeUp 0.6s 0.3s ease both;
}

button#run {
  width: 100%;
  background: var(--accent);
  color: #0a0b0c;
  border: none;
  border-radius: var(--radius);
  font-family: var(--font-head);
  font-size: 15px;
  font-weight: 700;
  letter-spacing: .02em;
  padding: 16px 28px;
  cursor: pointer;
  transition: all var(--transition);
  position: relative;
  overflow: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
}

button#run:hover:not(:disabled) {
  background: #d8ff5a;
  transform: translateY(-1px);
  box-shadow: 0 8px 32px rgba(200,240,74,0.25);
}

button#run:active:not(:disabled) {
  transform: translateY(0);
}

button#run:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.btn-icon { font-size: 17px; transition: transform var(--transition); }
button#run:hover .btn-icon { transform: translateX(3px); }

/* â”€â”€ Loader â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.loader {
  display: none;
  align-items: center;
  gap: 6px;
}

.loader-dot {
  width: 5px; height: 5px;
  background: #0a0b0c;
  border-radius: 50%;
  animation: bounce 0.8s ease infinite;
}
.loader-dot:nth-child(2) { animation-delay: 0.15s; }
.loader-dot:nth-child(3) { animation-delay: 0.3s; }

/* â”€â”€ Error banner â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#error-box {
  display: none;
  background: rgba(255,77,77,0.07);
  border: 1px solid rgba(255,77,77,0.25);
  border-radius: var(--radius);
  padding: 14px 18px;
  margin-top: 16px;
  font-family: var(--font-mono);
  font-size: 13px;
  color: #ff8080;
  animation: fadeUp 0.3s ease both;
}

/* â”€â”€ Results â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#results {
  display: none;
  margin-top: 32px;
  animation: fadeUp 0.5s ease both;
}

.results-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 20px;
}

.results-title {
  font-family: var(--font-head);
  font-size: 13px;
  font-weight: 700;
  letter-spacing: .08em;
  text-transform: uppercase;
  color: var(--accent);
  display: flex;
  align-items: center;
  gap: 8px;
}

.results-title::before {
  content: '';
  width: 6px; height: 6px;
  background: var(--accent);
  border-radius: 50%;
  box-shadow: 0 0 8px var(--accent);
}

.results-meta {
  font-family: var(--font-mono);
  font-size: 10px;
  color: var(--text-3);
}

/* Summary block */
.summary-block {
  background: var(--surface2);
  border: 1px solid var(--border2);
  border-left: 3px solid var(--accent);
  border-radius: var(--radius);
  padding: 18px 20px;
  font-size: 14.5px;
  font-weight: 300;
  color: var(--text);
  line-height: 1.7;
  margin-bottom: 20px;
}

/* Section headers */
.section-head {
  font-family: var(--font-mono);
  font-size: 10px;
  letter-spacing: .14em;
  text-transform: uppercase;
  color: var(--text-3);
  margin-bottom: 10px;
  margin-top: 24px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.section-head::after {
  content: '';
  flex: 1;
  height: 1px;
  background: var(--border);
}

/* Risk cards */
.risk-list { display: flex; flex-direction: column; gap: 10px; }

.risk-card {
  background: var(--surface2);
  border: 1px solid var(--border2);
  border-radius: var(--radius);
  padding: 14px 16px;
  display: flex;
  align-items: flex-start;
  gap: 14px;
  animation: fadeUp 0.4s ease both;
}

.priority-badge {
  flex-shrink: 0;
  font-family: var(--font-mono);
  font-size: 9px;
  font-weight: 400;
  letter-spacing: .1em;
  text-transform: uppercase;
  padding: 4px 9px;
  border-radius: 6px;
  margin-top: 1px;
}

.priority-high   { background: rgba(255,77,77,0.12);  color: #ff8080; border: 1px solid rgba(255,77,77,0.2); }
.priority-medium { background: rgba(240,160,32,0.12); color: #f0b050; border: 1px solid rgba(240,160,32,0.2); }
.priority-low    { background: rgba(77,166,255,0.12); color: #80c0ff; border: 1px solid rgba(77,166,255,0.2); }

.risk-desc {
  font-size: 14px;
  font-weight: 300;
  color: var(--text);
  line-height: 1.55;
}

/* Action item cards */
.action-list { display: flex; flex-direction: column; gap: 10px; }

.action-card {
  background: var(--surface2);
  border: 1px solid var(--border2);
  border-radius: var(--radius);
  padding: 14px 16px;
  animation: fadeUp 0.4s ease both;
}

.action-task {
  font-size: 14px;
  font-weight: 400;
  color: var(--text);
  line-height: 1.5;
  margin-bottom: 10px;
}

.action-meta {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.meta-chip {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  background: var(--surface3);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 3px 10px;
  font-family: var(--font-mono);
  font-size: 11px;
  color: var(--text-2);
}

.meta-chip-icon { font-size: 10px; opacity: 0.7; }

/* Empty state */
.empty-state {
  text-align: center;
  padding: 24px;
  color: var(--text-3);
  font-family: var(--font-mono);
  font-size: 12px;
}

/* Raw JSON toggle */
.json-toggle {
  margin-top: 24px;
  border-top: 1px solid var(--border);
  padding-top: 16px;
}

.json-toggle-btn {
  background: none;
  border: 1px solid var(--border2);
  border-radius: 8px;
  color: var(--text-3);
  font-family: var(--font-mono);
  font-size: 11px;
  padding: 6px 14px;
  cursor: pointer;
  transition: all var(--transition);
  display: flex;
  align-items: center;
  gap: 6px;
}

.json-toggle-btn:hover {
  border-color: var(--border2);
  color: var(--text-2);
  background: var(--surface2);
}

.json-block {
  display: none;
  margin-top: 12px;
  background: var(--surface2);
  border: 1px solid var(--border2);
  border-radius: var(--radius);
  padding: 16px;
  font-family: var(--font-mono);
  font-size: 12px;
  color: var(--text-2);
  line-height: 1.6;
  overflow-x: auto;
  white-space: pre;
}

/* â”€â”€ Footer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
footer {
  margin-top: 64px;
  padding-top: 24px;
  border-top: 1px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex-wrap: wrap;
  gap: 10px;
  animation: fadeUp 0.6s 0.5s ease both;
}

.footer-left {
  font-family: var(--font-mono);
  font-size: 11px;
  color: var(--text-3);
}

.footer-right {
  font-family: var(--font-mono);
  font-size: 11px;
  color: var(--text-3);
  display: flex;
  align-items: center;
  gap: 6px;
}

.status-dot {
  width: 5px; height: 5px;
  background: var(--accent);
  border-radius: 50%;
  box-shadow: 0 0 6px var(--accent);
  animation: pulse 2s ease infinite;
}

/* â”€â”€ Animations â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@keyframes fadeUp {
  from { opacity: 0; transform: translateY(14px); }
  to   { opacity: 1; transform: translateY(0); }
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50%       { opacity: 0.4; }
}

@keyframes bounce {
  0%, 80%, 100% { transform: scale(0.6); opacity: 0.5; }
  40%           { transform: scale(1);   opacity: 1; }
}

@keyframes shimmer {
  from { background-position: -200% 0; }
  to   { background-position: 200% 0; }
}

/* â”€â”€ Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@media (max-width: 520px) {
  .wrapper { padding: 40px 16px 80px; }
  h1 { font-size: 34px; }
  .card { padding: 20px; }
  .results-header { flex-direction: column; align-items: flex-start; gap: 6px; }
}
</style>
</head>
<body>
<div class="wrapper">

  <!-- Header -->
  <header>
    <div class="header-tag">AI Workflow Builder</div>
    <h1>Turn chaos into<br/><span>structured plans.</span></h1>
    <p class="subtitle">Paste any document. Describe what you need. Get a structured execution plan with risks and action items â€” instantly.</p>
  </header>

  <!-- Input: Instruction -->
  <div class="card">
    <div class="label">
      <span class="label-num">01</span>
      Instruction
    </div>
    <textarea
      id="instruction"
      placeholder="e.g. Review this quarterly report and extract all financial risks and action items."
      maxlength="2000"
    ></textarea>
    <div class="char-count" id="instruction-count">0 / 2000</div>
  </div>

  <!-- Input: Document -->
  <div class="card">
    <div class="label">
      <span class="label-num">02</span>
      Document
    </div>
    <textarea
      id="document"
      placeholder="Paste your document, report, email, or any unstructured text here..."
      maxlength="40000"
    ></textarea>
    <div class="char-count" id="document-count">0 / 40,000</div>
  </div>

  <!-- Run Button -->
  <div class="btn-row">
    <button id="run" onclick="runWorkflow()">
      <span id="btn-label" style="display:flex;align-items:center;gap:10px;">
        Generate Execution Plan
        <span class="btn-icon">â†’</span>
      </span>
      <span class="loader" id="btn-loader">
        <span class="loader-dot"></span>
        <span class="loader-dot"></span>
        <span class="loader-dot"></span>
      </span>
    </button>
  </div>

  <!-- Error box -->
  <div id="error-box"></div>

  <!-- Results -->
  <div id="results">
    <div class="results-header">
      <div class="results-title">Execution Plan</div>
      <div class="results-meta" id="results-meta"></div>
    </div>

    <!-- Summary -->
    <div class="summary-block" id="result-summary"></div>

    <!-- Risks -->
    <div class="section-head">Identified Risks</div>
    <div class="risk-list" id="result-risks"></div>

    <!-- Actions -->
    <div class="section-head">Action Items</div>
    <div class="action-list" id="result-actions"></div>

    <!-- Raw JSON -->
    <div class="json-toggle">
      <button class="json-toggle-btn" onclick="toggleJson()">
        <span id="json-toggle-label">{ } View raw JSON</span>
      </button>
      <pre class="json-block" id="json-block"></pre>
    </div>
  </div>

  <!-- Footer -->
  <footer>
    <div class="footer-left">AI Workflow Builder Â· FastAPI + Gemini 1.5</div>
    <div class="footer-right">
      <span class="status-dot"></span>
      <span id="footer-status">ready</span>
    </div>
  </footer>

</div>

<script>
// â”€â”€ Config â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// If frontend is served from same domain as API, leave as empty string.
// If hosted separately, set to your full Vercel URL:
// const API_BASE = 'https://your-project.vercel.app';
const API_BASE = 'https://ai-agent-three-umber.vercel.app';

// â”€â”€ Character counters â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setupCounter(textareaId, counterId, max) {
  const ta = document.getElementById(textareaId);
  const ct = document.getElementById(counterId);
  ta.addEventListener('input', () => {
    const len = ta.value.length;
    const pct = len / max;
    ct.textContent = `${len.toLocaleString()} / ${max.toLocaleString()}`;
    ct.className = 'char-count' + (pct > 1 ? ' over' : pct > 0.85 ? ' warn' : '');
  });
}
setupCounter('instruction', 'instruction-count', 2000);
setupCounter('document',    'document-count',    40000);

// â”€â”€ Sanitize input â€” strips control characters that break JSON â”€
function sanitize(str) {
  return str
    .replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g, ' ')
    .replace(/\r\n/g, '\n')
    .replace(/\r/g, '\n')
    .trim();
}

// â”€â”€ Main function â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function runWorkflow() {
  const instruction = sanitize(document.getElementById('instruction').value);
  const doc         = sanitize(document.getElementById('document').value);
  const errorBox    = document.getElementById('error-box');
  const results     = document.getElementById('results');
  const btn         = document.getElementById('run');

  // Clear previous state
  errorBox.style.display = 'none';
  results.style.display  = 'none';

  // Basic client-side validation
  if (!instruction) return showError('Please enter an instruction.');
  if (!doc)         return showError('Please paste a document.');
  if (instruction.length < 10) return showError('Instruction is too short â€” add more detail.');
  if (doc.length < 20)         return showError('Document is too short to analyse.');

  // Loading state
  setLoading(true);
  updateFooter('processing...');

  const t0 = Date.now();

  try {
    const res = await fetch(`${API_BASE}/process`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ instruction, document: doc }),
    });

    const data = await res.json();
    const elapsed = ((Date.now() - t0) / 1000).toFixed(1);

    if (!res.ok) {
      showError(data.detail || data.error || `Error ${res.status}`);
      updateFooter('error');
      return;
    }

    renderResults(data.result, elapsed, data.request_id);
    updateFooter('done');

  } catch (err) {
    if (err.name === 'TypeError' && err.message.includes('fetch')) {
      showError('Cannot reach the API. Make sure your backend is deployed and API_BASE is set correctly.');
    } else {
      showError('Unexpected error: ' + err.message);
    }
    updateFooter('error');
  } finally {
    setLoading(false);
  }
}

// â”€â”€ Render results â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderResults(result, elapsed, requestId) {
  const results = document.getElementById('results');

  // Meta
  document.getElementById('results-meta').textContent =
    `${elapsed}s Â· ${requestId ? requestId.slice(0,8) + 'â€¦' : ''}`;

  // Summary
  document.getElementById('result-summary').textContent = result.summary;

  // Risks
  const risksEl = document.getElementById('result-risks');
  risksEl.innerHTML = '';
  if (!result.risks || result.risks.length === 0) {
    risksEl.innerHTML = '<div class="empty-state">No risks identified.</div>';
  } else {
    result.risks.forEach((risk, i) => {
      const card = document.createElement('div');
      card.className = 'risk-card';
      card.style.animationDelay = `${i * 0.07}s`;
      card.innerHTML = `
        <span class="priority-badge priority-${risk.priority}">${risk.priority}</span>
        <span class="risk-desc">${escHtml(risk.description)}</span>
      `;
      risksEl.appendChild(card);
    });
  }

  // Actions
  const actionsEl = document.getElementById('result-actions');
  actionsEl.innerHTML = '';
  if (!result.action_items || result.action_items.length === 0) {
    actionsEl.innerHTML = '<div class="empty-state">No action items identified.</div>';
  } else {
    result.action_items.forEach((item, i) => {
      const card = document.createElement('div');
      card.className = 'action-card';
      card.style.animationDelay = `${i * 0.07}s`;
      card.innerHTML = `
        <div class="action-task">${escHtml(item.task)}</div>
        <div class="action-meta">
          <span class="meta-chip">
            <span class="meta-chip-icon">ðŸ‘¤</span>
            ${escHtml(item.owner)}
          </span>
          <span class="meta-chip">
            <span class="meta-chip-icon">ðŸ“…</span>
            ${escHtml(item.deadline)}
          </span>
        </div>
      `;
      actionsEl.appendChild(card);
    });
  }

  // Raw JSON
  document.getElementById('json-block').textContent = JSON.stringify(result, null, 2);

  results.style.display = 'block';
  results.scrollIntoView({ behavior: 'smooth', block: 'start' });
}

// â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setLoading(on) {
  const btn    = document.getElementById('run');
  const label  = document.getElementById('btn-label');
  const loader = document.getElementById('btn-loader');
  btn.disabled         = on;
  label.style.display  = on ? 'none' : 'flex';
  loader.style.display = on ? 'flex' : 'none';
}

function showError(msg) {
  const box = document.getElementById('error-box');
  box.textContent = 'âš  ' + msg;
  box.style.display = 'block';
}

function updateFooter(state) {
  document.getElementById('footer-status').textContent = state;
}

function toggleJson() {
  const block = document.getElementById('json-block');
  const label = document.getElementById('json-toggle-label');
  const visible = block.style.display === 'block';
  block.style.display = visible ? 'none' : 'block';
  label.textContent   = visible ? '{ } View raw JSON' : '{ } Hide raw JSON';
}

function escHtml(str) {
  return String(str)
    .replace(/&/g,'&amp;')
    .replace(/</g,'&lt;')
    .replace(/>/g,'&gt;')
    .replace(/"/g,'&quot;');
}

// Allow Ctrl+Enter to submit
document.addEventListener('keydown', e => {
  if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') runWorkflow();
});
</script>
</body>
</html>